---
title: "prep"
author: "Alexandra Norris"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(wbstats)
library(countrycode)
library(tidyverse)
library(ggplot2)
library(essurvey)
library(sf)
library(gganimate)
library(plotly)
library(rnaturalearth)
library(plotly)

```


```{r}

# refugees by country or territory of asylum

ref <- wb(indicator = "SM.POP.REFG")

ref_2018 <- ref %>%
  filter(date == 2018) %>%
  select(iso3c, country, value)

```

```{r}
# refugees by country or territory of origin

ref_origin <- wb(indicator = "SM.POP.REFG.OR") %>%
  select(iso3c, country, value, date) %>%
  slice(1335:6493)

```


```{r, refugee country of asylum and gdp}

# in aggregate, there is a negative correlation between refugees and GDP Per capita

gdp_percap <- wb(indicator = "NY.GDP.PCAP.KD.ZG")

gdp <- wb(indicator = "NY.GDP.MKTP.CD")

gdp_percap_ref <- merge(gdp_percap, ref, by = c("iso3c", "date", "country", "iso2c")) %>%
  mutate(gdp_percap_growth = value.x,
            refugee_number = value.y) %>%
  select(iso3c, iso2c, country, date, gdp_percap_growth, refugee_number)

data <- merge(gdp_percap_ref, gdp, by = c("iso3c", "date", "country", "iso2c")) %>%
  mutate(gdp = value) %>%
  select(iso3c, iso2c, country, date, gdp, gdp_percap_growth, refugee_number)

# refugees and gdp per cap growth 

x <- lm(gdp_percap_growth ~ refugee_number, data = data)

x %>%
  ggplot(aes(refugee_number, gdp_percap_growth)) +
  geom_point() +
  scale_x_continuous(labels = scales::comma) +
  geom_smooth(method = "lm")

# refugees and gdp per cap growth with gdp as explanatory variable

y <- lm(gdp_percap_growth ~ refugee_number + gdp, data = data)

y %>%
  ggplot(aes(refugee_number + gdp, gdp_percap_growth)) +
  geom_point() +
  scale_x_continuous(labels = scales::comma) +
  geom_smooth(method = "lm")

# refugees and gdp

z <- lm(gdp ~ refugee_number, data = data)

z %>%
  ggplot(aes(refugee_number, y = gdp)) + 
  geom_point() + 
  scale_x_continuous(labels = scales::comma) +
  scale_y_continuous(labels = scales::comma) +
  geom_smooth(method = "lm")

```

```{r}
# because of the negative correlation, I wanted to look at specific regions, what if I include GDP as a predictor of GDP growth rate?


```


```{r}
# refugee asylum location map 2018

plot_geo(data = ref_2018, locationmode = 'country names') %>%
  add_trace(
    z = ~value, locations = ~country, color = ~value, colors = "RdBu"
  )

```

