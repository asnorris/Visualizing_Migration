---
title: "prep"
author: "Alexandra Norris"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(wbstats)
library(countrycode)
library(tidyverse)
library(ggplot2)
library(essurvey)
library(sf)
library(gganimate)
library(plotly)
library(rnaturalearth)

```

For this pr
```{r}

# refugees by country or territory of asylum

ref <- wb(indicator = "SM.POP.REFG")


ref$continent <- countrycode(sourcevar = ref[, "country"],
                            origin = "country.name",
                            destination = "continent")

ref %>%
  filter(continent == "Europe")

europe_aggregate <- ref %>%
  filter(country == "Euro area")

ref_arrive<- ref %>%
  filter(continent == "Europe" | continent == "Asia" | continent == "North America" | continent == "South America" | continent ==  "Oceania" | continent == "Africa")

ref_arrive %>%
  group_by(date) %>%
  arrange(desc(value)) %>%
  head(10) %>%
  ggplot(aes(x = date, y = value, size = value)) +
  geom_col() 

euro_countries <- 

euro_countries %>%
  group_by(country) %>%
  ggplot(aes(x = date, y = value)) +
  geom_col()
  
europe_aggregate %>%
  ggplot(aes(date, value)) + geom_point()

```

```{r}
# refugees by country or territory of origin


```


```{r}
gdp <- wb(indicator = "NY.GDP.PCAP.KD.ZG")

gdp_euro_agg <- gdp %>%
  filter(country == "Euro area")

gdp$continent <- countrycode(sourcevar = ref[, "country"],
                            origin = "country.name",
                            destination = "continent")


```
```{r, refugees and gdp}
euro_agg <- merge(gdp_euro_agg, europe_aggregate, by = c("iso3c", "date", "country", "iso2c"))

# value.x is the gdp growth rate, value.y is the number or refugees

lm(value.x ~ value.y, data = euro_agg)

euro_agg %>%
  ggplot(aes(x = date, y = value.x)) + 
  geom_point() +
  transition_time(date)
```




```{r, cache=TRUE}

set_email("norrisalexandra35@gmail.com")

all_rounds <- import_all_rounds()

```

```{r ess cleaning}

one <- all_rounds[[1]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

two <- all_rounds[[2]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

three <- all_rounds[[3]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

four <- all_rounds[[4]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

five <- all_rounds[[5]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

six <- all_rounds[[6]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

seven <- all_rounds[[7]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

eight <- all_rounds[[8]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

nine <- all_rounds[[9]] %>%
  select(name, essround, cntry, agea, eduyrs, imdfetn, impcntr)

x <- rbind(one, two, three, four, five, six, seven, eight)

```

```{r}

y <- x %>%
  mutate(year = (essround * 2) + 2000) %>%
  mutate(year_ref_effect = year - 2) %>%


# %>%
#   countrycode(cntry, origin = "eurostat", destination = "iso3c")

```

```{r}

```


```{r}

download.file("https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson", destfile = "world")

shape <- st_read("world")


  ggplot() + 
  geom_sf(data = shape, color = "black")
  

  

```

